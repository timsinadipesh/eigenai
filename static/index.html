<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>frende</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
* {
  box-sizing: border-box;
}

body, #root {
  height: 100vh;
  margin: 0;
  padding: 0;
  width: 100vw;
  background: linear-gradient(135deg, #fefefe 0%, #f8f9fa 50%, #f5f7fa 100%);
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", Inter, system-ui, sans-serif;
  font-size: 16px;
  line-height: 1.5;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  height: 100vh;
  width: 100vw;
  padding: 20px 48px 48px;
  overflow-y: auto;
}

.content-wrapper {
  width: 100%;
  max-width: 580px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.header {
  text-align: center;
  margin-top: 10px;
  margin-bottom: 60px;
}

.header h1 {
  font-size: clamp(52px, 10vw, 68px);
  font-weight: 200;
  margin: 0 0 0 0;
  color: #0a0a0a;
  letter-spacing: -0.05em;
  background: linear-gradient(135deg, #1a1a1a 0%, #4a4a4a 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.header p {
  font-size: 17px;
  margin: -8px 0 0 0;
  color: #777777;
  font-weight: 400;
  letter-spacing: 0.01em;
}

.input-section {
  width: 100%;
}

.attachments {
  display: none;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 20px;
}

.attachments.active {
  display: flex;
}

.attachment-pill {
  display: flex;
  align-items: center;
  background: rgba(255, 255, 255, 0.8);
  backdrop-filter: blur(10px);
  padding: 10px 16px;
  border-radius: 20px;
  font-size: 14px;
  color: #555555;
  border: 1px solid rgba(0, 0, 0, 0.06);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
}

.attachment-pill span {
  max-width: 150px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.remove-attachment {
  background: none;
  border: none;
  cursor: pointer;
  padding: 0 0 0 10px;
  color: #999999;
  font-size: 18px;
  line-height: 1;
  transition: color 150ms ease;
}

.remove-attachment:hover {
  color: #666666;
}

.input-container {
  position: relative;
  width: 100%;
  margin-bottom: 32px;
}

.input-field {
  width: 100%;
  min-height: 56px;
  max-height: 120px;
  padding: 16px 120px 16px 56px;
  font-size: 16px;
  font-family: inherit;
  border: 2px solid #e5e5e5;
  border-radius: 28px;
  resize: none;
  background: #ffffff;
  transition: all 200ms ease;
  line-height: 1.4;
}

.input-field:focus {
  outline: none;
  border-color: #0066cc;
  border-width: 2px;
}

.input-field::placeholder {
  color: #aaaaaa;
  font-weight: 400;
}

.input-controls {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  align-items: center;
  gap: 8px;
}

.control-button {
  width: 40px;
  height: 40px;
  background: none;
  border: none;
  border-radius: 20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 200ms ease;
}

.control-button:hover {
  background: #f5f5f5;
}

.control-button:disabled {
  opacity: 0.3;
  cursor: not-allowed;
}

.control-button:disabled:hover {
  background: none;
}

.control-button svg {
  width: 20px;
  height: 20px;
  fill: #666666;
}

.send-button {
  background: linear-gradient(135deg, #0066cc 0%, #0052a3 100%);
  border: none;
}

.send-button:hover:not(:disabled) {
  background: linear-gradient(135deg, #0056b3 0%, #004080 100%);
  box-shadow: 0 4px 16px rgba(0, 102, 204, 0.25);
}

.send-button svg {
  fill: #ffffff;
}

.send-button:disabled {
  background: rgba(200, 200, 200, 0.6);
  border: 1px solid rgba(0, 0, 0, 0.06);
}

.send-button:disabled svg {
  fill: #999999;
}

.attachment-button {
  position: absolute;
  left: 8px;
  top: 50%;
  transform: translateY(-50%);
  width: 40px;
  height: 40px;
  background: none;
  border: none;
  border-radius: 20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 200ms ease;
}

.attachment-button:hover {
  background: #f5f5f5;
}

.attachment-button svg {
  width: 20px;
  height: 20px;
  fill: #666666;
}

.recording {
  background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%) !important;
  border: none !important;
}

.recording svg {
  fill: #ffffff !important;
}

/* Updated unified button styles */
.unified-buttons {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  width: 100%;
  margin-bottom: 24px;
}

.unified-button {
  padding: 18px 24px;
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(0, 102, 204, 0.3);
  border-radius: 16px;
  font-size: 15px;
  font-weight: 500;
  color: #0066cc;
  cursor: pointer;
  transition: all 250ms ease;
  text-align: center;
  box-shadow: 
    0 2px 8px -2px rgba(0, 0, 0, 0.06);
  letter-spacing: 0.01em;
}

.unified-button:hover {
  background: rgba(0, 102, 204, 0.05);
  border-color: rgba(0, 102, 204, 0.3);
  transform: translateY(-2px);
  box-shadow: 
    0 8px 30px -4px rgba(0, 102, 204, 0.25),
    0 4px 16px -2px rgba(0, 102, 204, 0.15);
  color: #0052a3;
}

.unified-button:active {
  transform: translateY(-1px);
  box-shadow: 
    0 4px 20px -2px rgba(0, 102, 204, 0.2),
    0 2px 8px -2px rgba(0, 102, 204, 0.1);
}

.create-job-section {
  width: 100%;
  margin-bottom: 24px;
}

.create-job-button {
  width: 100%;
  padding: 18px 24px;
  background: linear-gradient(135deg, #0066cc 0%, #0052a3 100%);
  border: none;
  border-radius: 16px;
  font-size: 15px;
  font-weight: 500;
  color: #ffffff;
  cursor: pointer;
  transition: all 250ms ease;
  text-align: center;
  box-shadow: 
    0 4px 20px -2px rgba(0, 102, 204, 0.3),
    0 2px 8px -2px rgba(0, 102, 204, 0.2);
  letter-spacing: 0.01em;
}

.create-job-button:hover {
  background: linear-gradient(135deg, #0056b3 0%, #004080 100%);
  transform: translateY(-2px);
  box-shadow: 
    0 8px 30px -4px rgba(0, 102, 204, 0.4),
    0 4px 16px -2px rgba(0, 102, 204, 0.3);
}

.create-job-button:active {
  transform: translateY(-1px);
}

.custom-jobs {
  width: 100%;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-bottom: 24px;
}

.custom-job-button {
  padding: 16px 20px;
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(0, 102, 204, 0.2);
  border-radius: 14px;
  font-size: 14px;
  font-weight: 500;
  color: #0066cc;
  cursor: pointer;
  transition: all 250ms ease;
  text-align: center;
  box-shadow: 
    0 3px 15px -2px rgba(0, 102, 204, 0.15),
    0 2px 6px -2px rgba(0, 0, 0, 0.04);
  letter-spacing: 0.01em;
  position: relative;
}

.custom-job-button:hover {
  background: rgba(0, 102, 204, 0.05);
  border-color: rgba(0, 102, 204, 0.3);
  transform: translateY(-2px);
  box-shadow: 
    0 6px 25px -4px rgba(0, 102, 204, 0.25),
    0 4px 12px -2px rgba(0, 102, 204, 0.08);
  color: #0052a3;
}

.custom-job-button:active {
  transform: translateY(-1px);
}

.edit-job, .delete-job {
  position: absolute;
  top: -8px;
  width: 20px;
  height: 20px;
  border: none;
  border-radius: 50%;
  color: white;
  font-size: 12px;
  font-weight: bold;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: opacity 200ms ease;
}

.edit-job {
  right: 12px;
  background: #28a745;
}

.edit-job:hover {
  background: #218838;
}

.delete-job {
  right: -8px;
  background: #dc3545;
}

.delete-job:hover {
  background: #c82333;
}

.custom-job-button:hover .edit-job,
.custom-job-button:hover .delete-job {
  opacity: 1;
}

/* Job Creation Modal */
.job-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 1000;
}

.job-modal.active {
  display: flex;
  align-items: center;
  justify-content: center;
}

.job-modal-content {
  background: white;
  padding: 2rem;
  border-radius: 16px;
  width: 90%;
  max-width: 600px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
  max-height: 80vh;
  overflow-y: auto;
}

.job-modal-content h2 {
  margin: 0 0 1.5rem 0;
  font-size: 1.5rem;
  color: #333;
  text-align: center;
}

.job-modal-content label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
  color: #555;
}

.job-modal-content input {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid #e5e5e5;
  border-radius: 8px;
  font-family: inherit;
  font-size: 16px;
  margin-bottom: 1rem;
  transition: border-color 200ms ease;
  box-sizing: border-box;
}

.job-modal-content input:focus {
  outline: none;
  border-color: #0066cc;
}

.job-modal-content textarea {
  width: 100%;
  min-height: 120px;
  padding: 12px 16px;
  border: 2px solid #e5e5e5;
  border-radius: 8px;
  font-family: inherit;
  font-size: 14px;
  resize: vertical;
  box-sizing: border-box;
  transition: border-color 200ms ease;
}

.job-modal-content textarea:focus {
  outline: none;
  border-color: #0066cc;
}

.job-modal-actions {
  display: flex;
  gap: 1rem;
  margin-top: 1.5rem;
  justify-content: flex-end;
}

.job-modal-btn {
  padding: 12px 24px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  transition: all 200ms ease;
}

.job-modal-btn.primary {
  background: #0066cc;
  color: white;
}

.job-modal-btn.primary:hover {
  background: #0056b3;
}

.job-modal-btn.secondary {
  background: #6c757d;
  color: white;
}

.job-modal-btn.secondary:hover {
  background: #5a6268;
}

@media (max-width: 768px) {
  .container {
    padding: 30px 24px 24px;
  }
  
  .content-wrapper {
    max-width: 100%;
  }
  
  .unified-buttons {
    grid-template-columns: 1fr;
    gap: 14px;
  }
  
  .custom-jobs {
    grid-template-columns: 1fr;
    gap: 12px;
  }
  
  .header h1 {
    font-size: clamp(40px, 10vw, 52px);
  }
  
  .header {
    margin-bottom: 40px;
  }
}

@media (max-width: 480px) {
  .container {
    padding: 24px 20px 20px;
  }
  
  .input-field {
    padding: 14px 100px 14px 48px;
    min-height: 48px;
  }
  
  .attachment-button,
  .control-button {
    width: 36px;
    height: 36px;
  }
  
  .control-button svg,
  .attachment-button svg {
    width: 18px;
    height: 18px;
  }
  
  .unified-button {
    padding: 16px 20px;
    font-size: 14px;
  }
  
  .create-job-button {
    padding: 16px 20px;
    font-size: 14px;
  }
  
  .custom-job-button {
    padding: 14px 16px;
    font-size: 13px;
  }
}

#file-input {
  display: none;
}
  </style>
</head>
<body>
<div id="root">
  <div class="container">
    <div class="content-wrapper">
      <div class="header">
        <h1>frende</h1>
        <p>private on-device ai companion</p>
      </div>
      
      <div class="input-section">
        <div class="attachments" id="attachment-display"></div>
        
        <div class="input-container">
          <button class="attachment-button" id="attachment-btn">
            <svg viewBox="0 0 24 24">
              <path d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v11.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"/>
            </svg>
          </button>
          
          <textarea
            id="chat-input"
            class="input-field"
            placeholder="hello frende..."
            rows="1"
          ></textarea>
          
          <div class="input-controls">
            <button class="control-button" id="mic-btn">
              <svg viewBox="0 0 24 24">
                <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.49 6-3.31 6-6.72h-1.7z"/>
              </svg>
            </button>
            
            <button class="control-button send-button" id="send-btn" disabled>
              <svg viewBox="0 0 24 24">
                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
              </svg>
            </button>
          </div>
          
          <input type="file" id="file-input" multiple accept="image/*,audio/*" hidden>
        </div>
        
        <div class="unified-buttons">
          <button class="unified-button" id="translator-btn">Multimodal Interpreter</button>
          <button class="unified-button" id="folderCruncher-btn">FolderCruncher</button>
          <button class="unified-button" id="teacher-btn">Teacher</button>
          <button class="unified-button" id="corrector-btn">Corrector</button>
        </div>
        
        <div class="create-job-section">
          <button class="create-job-button" id="create-job-btn">+ Create AI Job</button>
        </div>
        
        <div class="custom-jobs" id="custom-jobs"></div>
      </div>
    </div>
  </div>
</div>

<!-- Job Creation Modal -->
<div id="jobModal" class="job-modal">
  <div class="job-modal-content">
    <h2 id="modal-title">Create Custom AI Job</h2>
    <label for="jobName">Job Name:</label>
    <input 
      type="text" 
      id="jobName" 
      placeholder="e.g., Code Reviewer, Story Writer, etc."
      maxlength="50"
    >
    
    <label for="jobPrompt">System Prompt:</label>
    <textarea 
      id="jobPrompt" 
      placeholder="Define what this AI should do, its personality, and how it should respond..."
    ></textarea>
    
    <div class="job-modal-actions">
      <button class="job-modal-btn secondary" onclick="closeJobModal()">Cancel</button>
      <button class="job-modal-btn primary" id="save-job-btn" onclick="saveJob()">Create Job</button>
    </div>
  </div>
</div>

<script>
class LandingPage {
  constructor() {
    this.attachedFiles = new Map();
    this.isRecording = false;
    this.mediaRecorder = null;
    this.audioChunks = [];
    this.editingJobId = null; // Track if we're editing an existing job
    
    this.initializeEventListeners();
    this.autoResizeTextarea();
    this.updateSendButton();
    this.loadCustomJobs();
    
    // Auto-focus on input field when page loads
    document.getElementById('chat-input').focus();
  }

  initializeEventListeners() {
    // Navigation buttons - redirect to chat with context
    document.getElementById('translator-btn').addEventListener('click', () => {
      this.goToChat('translator');
    });
    
    document.getElementById('folderCruncher-btn').addEventListener('click', () => {
      this.goToChat('folderCruncher', null, 'static/fcrunch.html');
    });
    
    document.getElementById('teacher-btn').addEventListener('click', () => {
      this.goToChat('teacher');
    });
    
    document.getElementById('corrector-btn').addEventListener('click', () => {
      this.goToChat('corrector');
    });

    // Create AI Job button
    document.getElementById('create-job-btn').addEventListener('click', () => {
      this.openJobModal();
    });

    // Input handling
    const chatInput = document.getElementById('chat-input');
    const sendBtn = document.getElementById('send-btn');
    
    chatInput.addEventListener('input', () => {
      this.autoResizeTextarea();
      this.updateSendButton();
    });

    chatInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        if (!sendBtn.disabled) {
          e.preventDefault();
          this.handleDirectMessage();
        }
      }
    });

    sendBtn.addEventListener('click', () => {
      this.handleDirectMessage();
    });

    // File attachments
    document.getElementById('attachment-btn').addEventListener('click', () => {
      document.getElementById('file-input').click();
    });

    document.getElementById('file-input').addEventListener('change', (e) => {
      this.handleFileSelect(e);
    });

    // Audio recording
    document.getElementById('mic-btn').addEventListener('click', () => {
      this.handleMicClick();
    });

    // Modal event listeners
    document.addEventListener('click', (e) => {
      const modal = document.getElementById('jobModal');
      if (e.target === modal) {
        this.closeJobModal();
      }
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        this.closeJobModal();
      }
    });
  }

  goToChat(mode = 'general', customJob = null, targetUrl = null) {
    // Store any current input/attachments in sessionStorage
    const chatInput = document.getElementById('chat-input');
    const currentMessage = chatInput.value.trim();
    
    // Determine the target URL based on mode
    if (!targetUrl) {
      targetUrl = mode === 'translator' ? 'static/transl.html' : 'static/chat.html';
    }
    
    const chatData = {
      message: currentMessage,
      files: Array.from(this.attachedFiles.entries()),
      mode: mode,
      customJob: customJob,
      timestamp: Date.now()
    };
    
    if (currentMessage || this.attachedFiles.size > 0) {
      // Convert file data to base64 for storage
      Promise.all(
        chatData.files.map(async ([name, file]) => {
          return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = () => resolve([name, {
              data: reader.result,
              type: file.type,
              name: file.name
            }]);
            reader.readAsDataURL(file);
          });
        })
      ).then((filesData) => {
        chatData.files = filesData;
        sessionStorage.setItem('chatTransition', JSON.stringify(chatData));
        window.location.href = targetUrl;
      });
    } else {
      // Just go to chat with mode/job
      sessionStorage.setItem('chatTransition', JSON.stringify(chatData));
      window.location.href = targetUrl;
    }
  }

  handleDirectMessage() {
    // If user types and hits send, go directly to chat
    this.goToChat('direct');
  }

  handleFileSelect(e) {
    const files = e.target.files;
    for (let file of files) {
      if (!this.attachedFiles.has(file.name)) {
        this.attachedFiles.set(file.name, file);
      }
    }
    this.renderAttachments();
    this.updateSendButton();
    e.target.value = '';
  }

  async handleMicClick() {
    const micBtn = document.getElementById('mic-btn');
    
    if (!this.isRecording) {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        this.mediaRecorder = new MediaRecorder(stream);
        this.audioChunks = [];
        
        this.mediaRecorder.ondataavailable = (event) => {
          this.audioChunks.push(event.data);
        };
        
        this.mediaRecorder.onstop = () => {
          const audioBlob = new Blob(this.audioChunks, { type: "audio/webm" });
          const audioName = `recording-${Date.now()}.webm`;
          this.attachedFiles.set(audioName, audioBlob);
          this.renderAttachments();
          this.updateSendButton();
          stream.getTracks().forEach(track => track.stop());
        };
        
        this.mediaRecorder.start();
        this.isRecording = true;
        micBtn.classList.add('recording');
      } catch (err) {
        alert("Could not access microphone. Please check permissions.");
      }
    } else {
      if (this.mediaRecorder) this.mediaRecorder.stop();
      this.isRecording = false;
      micBtn.classList.remove('recording');
    }
  }

  renderAttachments() {
    const display = document.getElementById('attachment-display');
    display.innerHTML = '';
    
    if (this.attachedFiles.size === 0) {
      display.classList.remove('active');
      return;
    }
    
    display.classList.add('active');
    
    this.attachedFiles.forEach((file, name) => {
      const pill = document.createElement('div');
      pill.className = 'attachment-pill';
      
      const span = document.createElement('span');
      span.textContent = name;
      
      const btn = document.createElement('button');
      btn.className = 'remove-attachment';
      btn.textContent = '×';
      btn.onclick = () => {
        this.attachedFiles.delete(name);
        this.renderAttachments();
        this.updateSendButton();
      };
      
      pill.appendChild(span);
      pill.appendChild(btn);
      display.appendChild(pill);
    });
  }

  updateSendButton() {
    const chatInput = document.getElementById('chat-input');
    const sendBtn = document.getElementById('send-btn');
    const hasText = chatInput.value.trim().length > 0;
    const hasFiles = this.attachedFiles.size > 0;
    
    sendBtn.disabled = !hasText && !hasFiles;
  }

  autoResizeTextarea() {
    const textarea = document.getElementById('chat-input');
    textarea.style.height = 'auto';
    
    const maxHeight = 120;
    if (textarea.scrollHeight > maxHeight) {
      textarea.style.height = maxHeight + 'px';
      textarea.style.overflowY = 'auto';
    } else {
      textarea.style.height = textarea.scrollHeight + 'px';
      textarea.style.overflowY = 'hidden';
    }
  }

  // Custom Jobs Management
  openJobModal(job = null) {
    const modal = document.getElementById('jobModal');
    const modalTitle = document.getElementById('modal-title');
    const nameInput = document.getElementById('jobName');
    const promptInput = document.getElementById('jobPrompt');
    const saveBtn = document.getElementById('save-job-btn');
    
    if (job) {
      // Editing existing job
      this.editingJobId = job.id;
      modalTitle.textContent = 'Edit AI Job';
      nameInput.value = job.name;
      promptInput.value = job.systemPrompt;
      saveBtn.textContent = 'Update Job';
    } else {
      // Creating new job
      this.editingJobId = null;
      modalTitle.textContent = 'Create Custom AI Job';
      nameInput.value = '';
      promptInput.value = '';
      saveBtn.textContent = 'Create Job';
    }
    
    modal.classList.add('active');
    setTimeout(() => nameInput.focus(), 100);
  }

  closeJobModal() {
    const modal = document.getElementById('jobModal');
    modal.classList.remove('active');
    this.editingJobId = null;
  }

  saveJob() {
    const nameInput = document.getElementById('jobName');
    const promptInput = document.getElementById('jobPrompt');
    
    const name = nameInput.value.trim();
    const prompt = promptInput.value.trim();
    
    if (!name) {
      alert('Please enter a job name');
      nameInput.focus();
      return;
    }
    
    if (!prompt) {
      alert('Please enter a system prompt');
      promptInput.focus();
      return;
    }
    
    // Get existing jobs
    const existingJobs = this.getCustomJobs();
    
    if (this.editingJobId) {
      // Editing existing job
      const jobIndex = existingJobs.findIndex(job => job.id === this.editingJobId);
      if (jobIndex !== -1) {
        // Check for duplicate names (excluding current job)
        if (existingJobs.some(job => job.id !== this.editingJobId && job.name.toLowerCase() === name.toLowerCase())) {
          alert('A job with this name already exists');
          nameInput.focus();
          return;
        }
        
        // Update existing job
        existingJobs[jobIndex].name = name;
        existingJobs[jobIndex].systemPrompt = prompt;
        existingJobs[jobIndex].updatedAt = new Date().toISOString();
      }
    } else {
      // Creating new job
      // Check for duplicate names
      if (existingJobs.some(job => job.name.toLowerCase() === name.toLowerCase())) {
        alert('A job with this name already exists');
        nameInput.focus();
        return;
      }
      
      // Create new job
      const newJob = {
        id: Date.now().toString(),
        name: name,
        systemPrompt: prompt,
        createdAt: new Date().toISOString()
      };
      
      existingJobs.push(newJob);
    }
    
    // Save to localStorage
    localStorage.setItem('customAIJobs', JSON.stringify(existingJobs));
    
    // Refresh the UI
    this.loadCustomJobs();
    this.closeJobModal();
  }

  getCustomJobs() {
    try {
      const jobs = localStorage.getItem('customAIJobs');
      return jobs ? JSON.parse(jobs) : [];
    } catch (error) {
      console.error('Error loading custom jobs:', error);
      return [];
    }
  }

  loadCustomJobs() {
    const jobsContainer = document.getElementById('custom-jobs');
    const jobs = this.getCustomJobs();
    
    jobsContainer.innerHTML = '';
    
    if (jobs.length === 0) {
      jobsContainer.style.display = 'none';
      return;
    }
    
    jobsContainer.style.display = 'grid';
    
    jobs.forEach(job => {
      const jobButton = document.createElement('button');
      jobButton.className = 'custom-job-button';
      jobButton.textContent = job.name;
      
      // Add edit button
      const editBtn = document.createElement('button');
      editBtn.className = 'edit-job';
      editBtn.innerHTML = '✎';
      editBtn.onclick = (e) => {
        e.stopPropagation();
        this.editJob(job.id);
      };
      
      // Add delete button
      const deleteBtn = document.createElement('button');
      deleteBtn.className = 'delete-job';
      deleteBtn.innerHTML = '×';
      deleteBtn.onclick = (e) => {
        e.stopPropagation();
        this.deleteJob(job.id);
      };
      
      jobButton.appendChild(editBtn);
      jobButton.appendChild(deleteBtn);
      
      // Add click handler for the job button
      jobButton.onclick = () => {
        this.goToChat('custom', job);
      };
      
      jobsContainer.appendChild(jobButton);
    });
  }

  editJob(jobId) {
    const jobs = this.getCustomJobs();
    const job = jobs.find(j => j.id === jobId);
    if (job) {
      this.openJobModal(job);
    }
  }

  deleteJob(jobId) {
    if (!confirm('Are you sure you want to delete this AI job?')) {
      return;
    }
    
    const jobs = this.getCustomJobs();
    const updatedJobs = jobs.filter(job => job.id !== jobId);
    
    localStorage.setItem('customAIJobs', JSON.stringify(updatedJobs));
    this.loadCustomJobs();
  }
}

// Global functions for modal
function closeJobModal() {
  if (window.landingPageInstance) {
    window.landingPageInstance.closeJobModal();
  }
}

function saveJob() {
  if (window.landingPageInstance) {
    window.landingPageInstance.saveJob();
  }
}

// Initialize the landing page
document.addEventListener('DOMContentLoaded', () => {
  window.landingPageInstance = new LandingPage();
});
</script>
</body>
</html>